---
title: "test shinyapps not finding packages in join tutorial"
output: learnr::tutorial
runtime: shiny_prerendered
description: >
  test sf 
---

Trying to diagnose why join tutorial not working on shinyapps
Could it be a tmap issue ?

```{r setup, include=FALSE}

# To install a package
#usethis::use_package("<external-package>")

#allow_skip: true

# library to run the tutorial
library(learnr)
#knitr::opts_chunk$set()

```


```{r library_packages, include=FALSE}

# working with geographic data
library(sf) 

#plotting and data wrangling
#library(tidyverse) #reducing dependencies
library(dplyr)
library(ggplot2)

# plotting and exploring geographic data
library(mapview) 

# gapminder data
library(gapminder) 

# afrilearndata
library(afrilearndata)

# include leaflet for mapping
library(leaflet)

# interactive map using tmap
library(tmap)

# icons
library(fontawesome)

# tables
library(kableExtra)

# labels
library(ggrepel)

# Set up the first data.frame
africa_gap <- gapminder %>%
                  filter(continent == "Africa",
                         year == 2007)
```



```{r tmap_data_sample, eval = TRUE, echo = FALSE, message = FALSE, warning=FALSE}

#temporary fix for shinyapps & may help for users with an older version of rgdal
sf::st_crs(africapitals) <- 4326
sf::st_crs(afrihighway) <- 4326
sf::st_crs(africountries) <- 4326
sf::st_crs(africontinent) <- 4326 

tmap_mode("view")

t <-  tm_shape(africountries) +
      tm_polygons(col = "tan", alpha = 0.2, border.col = "black") +
      tm_shape(afripop2000)  +
      tm_raster(palette = terrain.colors(10), style="fisher") +
      tm_shape(afripop2020)  +
      tm_raster(palette = terrain.colors(10), style="fisher") +
      tm_shape(afrihighway) +
      tm_lines(col = "red") + 
      tm_shape(africapitals) +
      tm_symbols(col = "blue", shape= 1, scale = 0.7) + #shape=1 for open circle
      tm_legend(show = TRUE)

t %>% 
  tmap_leaflet() %>%
  leaflet::hideGroup("africapitals") %>%
  leaflet::hideGroup("afripop2000") %>%
  leaflet::hideGroup("afrihighway") %>%
  leaflet::hideGroup("afripop2020")

```






